<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="APPLESHOP54 - Магазин трендовых товаров">
    <link rel="shortcut icon" href="/static/ico/favicon.png">

    <title>APPLESHOP54 - Магазин трендовых товаров</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/main.css" rel="stylesheet">
    <link href="/static/css/appleshop54.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/icomoon.css">
    <link href="/static/css/animate-custom.css" rel="stylesheet">



    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>

    <script src="/static/js/jquery.min.js"></script>
	<script type="text/javascript" src="/static/js/modernizr.custom.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="static/js/html5shiv.js"></script>
      <script src="static/js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-offset="0" data-target="#navbar-main">
   <nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">appleshop54.ru</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="/ad">Продукты <span class="sr-only">(current)</span></a></li>
        <li><a href="/ad?specs">Спецпредложения</a></li>

      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
    <div class="container">
        <h2 id="progress-label"><a class="anchorjs-link " href="#progress-label" aria-label="Anchor link for: progress label" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant-ligatures: normal; font-variant-position: normal; font-variant-caps: normal; font-variant-numeric: normal; font-variant-alternates: normal; font-variant-east-asian: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Добавление товара</h2>
        <h3 id="productId">ID продукта: -</h3>
        <div class="form-group">
          <label for="typeProduct">Выбор типа продукта :</label>
          <select class="form-control" id="typeProduct">
          </select>
        </div>
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon1">Название</span>
          <input type="text" class="form-control" placeholder="Название" aria-describedby="basic-addon1">
        </div>
        <br>
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon1">Цена</span>
          <input type="text" class="form-control" placeholder="Цена" aria-describedby="basic-addon1">
        </div>
        <br>
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon1">Описание</span>
          <input type="text" class="form-control" placeholder="Описание" aria-describedby="basic-addon1">
        </div>
        <h2 id="progress-label"><a class="anchorjs-link " href="#progress-label" aria-label="Anchor link for: progress label" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant-ligatures: normal; font-variant-position: normal; font-variant-caps: normal; font-variant-numeric: normal; font-variant-alternates: normal; font-variant-east-asian: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Фотографии продукта</h2>

        <form id="upload-file" method="post" enctype="multipart/form-data">
            <fieldset>
                <label for="file">Выберите файл для загрузки</label>
                <input name="file" type="file">
            </fieldset>
            <fieldset>
                <button id="upload-file-btn" type="button" class="btn btn-default btn-info">Загрузить</button>
            </fieldset>
        </form>
        <div class="row" id="imagesProduct">

        </div>
        <div class="row" id="tableSpecs">
            <h2 id="progress-label"><a class="anchorjs-link " href="#progress-label" aria-label="Anchor link for: progress label" data-anchorjs-icon="" style="font-family: anchorjs-icons; font-style: normal; font-variant-ligatures: normal; font-variant-position: normal; font-variant-caps: normal; font-variant-numeric: normal; font-variant-alternates: normal; font-variant-east-asian: normal; font-weight: normal; line-height: inherit; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Характеристики продукта</h2>
            <form class="form-horizontal">
              <div class="form-group">
                <label for="inputType" class="col-lg-1 control-label">Название</label>
                <div class="col-lg-3">
                  <input type="text" class="form-control" id="inputSpecsName" placeholder="Название">
                </div>
                <label for="inputType" class="col-lg-1 control-label">Значение</label>
                <div class="col-lg-3">
                  <input type="text" class="form-control" id="inputSpecsValue" placeholder="Значение">
                </div>
                <button class="btn btn-success" onclick="addSpec()">Добавить</button>
              </div>
            </form>
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Название</th>
                        <th>Значение</th>
                        <th>Удалить</th>
                    </tr>
                </thead>
                <tbody id="specsBody">

                </tbody>
            </table>
        </div>
    </div>
    <script>
        Array.prototype.remove = function(from, to) {
          var rest = this.slice((to || from) + 1 || this.length);
          this.length = from < 0 ? this.length + from : from;
          return this.push.apply(this, rest);
        };
        var specs = new Array();
        var imageIDs = new Array();
        var typeProd = 1;
        $( "#typeProduct" ).change(function(data) {
            typeProd = $( "#typeProduct" ).val();
        });
        function removeSpec(removeI){
            specs.remove(removeI);
            updateSpecsTable();
        }
        function addSpec(){
            specs.push({'specName':$("#inputSpecsName").val(), 'specValue': $("#inputSpecsValue").val()});
            updateSpecsTable();
        }
        function updateSpecsTable(){
            var html = "";
            for(var i = 0;i < specs.length; i++){
                html += "<tr> <td> " + i.toString() + "</td>";
                html += "<td>" + specs[i].specName + "</td>";
                html += "<td>" + specs[i].specValue + "</td>";
                html += '<td><a class="btn btn-danger" onclick="removeSpec(' + i.toString() + ')">Удалить</a></td></tr>';
            }
            $("#specsBody").html(html);
        }
        function setMain(image_id){
            $.get('/ad/img/setMain?image_id='+image_id.toString())
            .done(function (data) {
                loadAllImages();
            })
            .fail(function(data){
                alert(data);
            });
        }
        function removeImage(image_id){
            $.get('/ad/img/remove?image_id='+image_id.toString())
            .done(function (data) {
                loadAllImages();
            })
            .fail(function(data){
                alert(data);
            });
        }
        function loadAllImages(){
            $.get('/ad/img/all')
            .done(function (data) {
                data = JSON.parse(data);
                console.log(data);
                var html = "";
                imageIDs = new Array();
                for(var i = 0; i< data.length; i++){
                    imageIDs.push(data[i].id);
                    console.log(data[i].is_main == true?'btn-success' : '');
                    html += '<div class="col-xs-6 col-md-3"> <div class="thumbnail">';
                    html += '<img src="'+ data[i].image +'" alt="..." id="img1" imageId='+ data[i].id +'>';
                    html += '<div class="caption">' +
                            '<p><a onclick="removeImage('+ data[i].id +')" class="btn btn-primary" role="button">Удалить изображение</a> ';
                    if(data[i].is_main == true)
                        html += '<a onclick="setMain('+ data[i].id +')" class="btn btn-default btn-success" role="button">Поставить главной</a></p></div></div></div>';
                    else
                        html += '<a onclick="setMain('+ data[i].id +')" class="btn btn-default" role="button">Поставить главной</a></p></div></div></div>';
                }
                $("#imagesProduct").html(html);

            })
            .fail(function (data) {

            });
        }
        function loadTypes(){
            $.get("/ad/product/get_types")
            .done(function(data){
                data = JSON.parse(data);
                console.log(data);
                var html = "";
                for(var i = 0; i < data.length; i++){
                    html += '<option value="' + data[i].id +'">' + data[i].type_name + '</option>';
                }
                $("#typeProduct").html(html);
            })
            .fail(function(data){
                alert(data);
            });
        }
        function loadProductID(){
            $.get('/ad/product/next')
            .done(function(data){
                data = JSON.parse(data);
                console.log(data);
                $("#productId").text('ID продукта: ' + data.productId.toString());
            })
            .fail(function(data){
                alert(data);
            });
        }
        $(window).load(function () {
            loadAllImages();
            loadProductID();
            loadTypes();
        });
        /*<div class="col-xs-6 col-md-3">
                <a href="#" class="thumbnail">
                  <img src="" alt="..." id="img1">
                </a>
             </div>*/
        $(function() {
        $('#upload-file-btn').click(function() {
            var form_data = new FormData($('#upload-file')[0]);
            $.ajax({
                type: 'POST',
                url: '/upload',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                async: false,
                success: function(data) {
                    console.log('Success!');

                    data = JSON.parse(data);
                    console.log(data);
                    loadAllImages();
                }
            });
        });
    });
    </script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/static/js/retina.js"></script>
	<script type="text/javascript" src="/static/js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="/static/js/smoothscroll.js"></script>
  </body>
</html>
